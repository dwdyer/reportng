## This macro formats the results (whether passed, skipped or failed) of the test
## methods in a single class for inclusion in the HTML report.  It assumes that the
## the results are in a variable called $sortedResults and that the class is referred
## to by the $testClass variable.  $id is a page scope variable that is used to assign
## unique identifiers to divs.

#foreach( $testResult in $sortedResults.get($testClass) )
<tr>
  <td>$testResult.name</td>
  <td>$utils.formatDuration($testResult.startMillis, $testResult.endMillis)s</td>
  <td>
    #if( $testResult.method.description.length() > 0 )
      <div class="description">
        $testResult.method.description
      </div>
    #end

    ## Display the dependencies for skipped test methods.
    #if( $testResult.status == 3 ) ## 3 means skipped.
      #set( $arrayLength = $utils.getArrayLength($testResult.method.groupsDependedUpon) )
      #if( $arrayLength > 0 )
        <i>Depends on group(s): </i>
        #foreach( $group in $testResult.method.groupsDependedUpon )
          #if( $velocityCount < $arrayLength - 1 )
            <span class="dependency">${group}</span>,
          #else
            <span class="dependency">${group}</span>
          #end
        #end
        <br />
      #end
      #set( $arrayLength = $utils.getArrayLength($testResult.method.methodsDependedUpon) )
      #if( $arrayLength > 0 )
        <i>Depends on method(s): </i>
        #foreach( $method in $testResult.method.methodsDependedUpon )
          #if( $velocityCount < $arrayLength - 1 )
            <span class="dependency">${method}</span>,
          #else
            <span class="dependency">${method}</span>
          #end
        #end
      #end
    #end

    #set( $output = $utils.getTestOutput($testResult) )
    #if( $output.size() > 0)
    <div class="output">
      #foreach( $line in $output )
      $line<br />
      #end
    </div>
    #end


    #if( $testResult.throwable && ( $testResult.status == 2 || $utils.shouldShowExpectedExceptions() ))
    <a href="javascript:toggleDiv('exception-$id')" title="Click to expand/collapse"><b>$utils.escapeHTMLString( $testResult.throwable.toString() )</b></a><br />
    <div class="stackTrace" id="exception-$id">
      #foreach( $element in $testResult.throwable.stackTrace )
        $utils.escapeString( $element.toString() )<br />
      #end
      #set( $causes = $utils.getCauses($testResult.throwable) )
      #foreach( $throwable in $causes )
        #set ($id = $id + 1)
        <b>Caused by: </b> <a href="javascript:toggleDiv('exception-$id')" title="Click to expand/collapse">$utils.escapeHTMLString( $throwable.toString() )</a><br />
        <div class="stackTrace" id="exception-$id">
          #foreach( $element in $throwable.stackTrace )
            $utils.escapeString( $element.toString() )<br />
          #end
        </div>
      #end
    </div>
    #end
    #set ($id = $id + 1)
  </td>
</tr>
#end
